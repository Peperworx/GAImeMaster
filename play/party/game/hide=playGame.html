<html>
    <head>
        
        <link rel="stylesheet" href="/static/bootstrap-4.3.1-dist/css/bootstrap.min.css" crossorigin="anonymous">
        <link rel="stylesheet" href="/static/w3.css">
        <title>play | gAImeMaster</title>
        <link rel="stylesheet" href="/static/noty/lib/noty.css">
        <link rel="stylesheet"  href="/static/noty/lib/themes/metroui.css" />
        <link rel="stylesheet"  href="/static/noty/lib/themes/mint.css" />
        <link rel="stylesheet" href="/static/jquery-ui/jquery-ui.min.css">
        <style>
        html,body {
            margin:0;
            height:100%;
            width:100%;
        }
        #chat {
            list-style: none;
            padding:1px;
            width:100%;
            height:70%;
            overflow: scroll;
        }
        .welcome {
            font-size:1em;
            width:100%;
        }
        #chatform {
            width:100%;
            top:100%;
            bottom:0px;
        }
        #chatbox {
            width:100%;
        }
        #chatContainer {
            background-color:white;
            width:20%;
            min-width:20%;
            margin:2px;
            height:50%;
            min-height:50%;
            resize: both;
            overflow:auto;
            border: 2px solid lightgray;
        }
        #partyStatus {
            background-color:white;
            width:20%;
            min-width:20%;
            margin:2px;
            height:50%;
            min-height:50%;
            resize: both;
            overflow:auto;
            border: 2px solid lightgray;
        }
        .username {
            margin-right:5px;
        }
        .bar:after {
            content:"\007C";
        }
        .message {
            margin-left:5px;
        }
        #chatHeader {
            padding-bottom:5px;
            border-bottom: 1px solid lightgray;
        }
        #partyHeader {
            padding-bottom:5px;
            border-bottom: 1px solid lightgray;
        }
        #mainrow {
            height:100%;
        }
        </style>
    </head>
    <body>
        <div class="container-fluid">
            <div id="mainrow" class="row">
                <div id="chatContainer" class="col-">
                    <h4 id="chatHeader" class="w3-center">Chat</h4>
                    <ul id="chat" class="">
                        <li><span class="welcome">Welcome To Beginning of chat!</span></li>
                    </ul>
                    <form id="chatform">
                        <input type="text" id="chatbox" placeholder="Type your message here...">
                    </form>
                </div>
                <div id="partyStatus" class="col-">
                    <h4 id="partyHeader" class="w3-center">Party Status</h4>
                    <ul id="members" class="">

                    </ul>
            <div class="row">
        </div>
        </div>

        <script src="/static/jquery.js"></script>
        <script src="/static/js.cookie-2.2.0.min.js"></script>
        <script src="/static/bootstrap-4.3.1-dist/js/bootstrap.js"></script>
        <script src="/static/noty/lib/noty.js"></script>
        <script src="/static/bootbox.all.min.js"></script>
        <script src="/static/socket.io.js"></script>
        <script src="/static/jquery-ui/jquery-ui.min.js"></script>
        <script>
            var players = []
            var id = "{{ id }}";
            var socket = io("http://"+location.host+":3435");
            socket.emit("checkIn", Cookies.get("username"))
            socket.emit("joinGame", {"ID":id,"UNAME":Cookies.get("username")})
            socket.emit("room",id);
            $("#chatform").submit(function(event){
                event.preventDefault();
                event.stopPropagation();
                socket.emit("sendChat", {"partyID":id,"UNAME":Cookies.get("username"),"message":$("#chatbox").val()});
                $("#chatbox").val("");
            });
            socket.on("newMsg", function(data){
                $("#chat").append("<li class='chatItem'><span class='username'>"+data["UNAME"]+"</span><span class='bar'></span><span class='message'>"+data["message"]+"</span></li>");
            });
            socket.on("playerJoined", function(data) {
                $("#players").append("<li><span class='playeruname'>"+data["UNAME"]+"</span><span class='charactername'>"+data["CHAR"]["NAME"]+"</span><span class='class'>"+data["CHAR"]["CLASS"]+"</span></li>");
                players.push(data);
            });
            $("#chatContainer").draggable({handle:'#chatHeader', grid: [ 10, 10 ] });
            $("#partyStatus").draggable({handle:'#partyHeader', grid: [ 10, 10 ] });
        </script>
    </body>
</html>